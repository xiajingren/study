# mysql

mysql学习笔记。。。

## 索引

索引是帮助mysql高效获取数据的排好序的数据结构

### 数据结构

![image-20210702160121818](README.assets\image-20210702160121818.png)

#### 二叉树

左边的子节点小于父节点，右边子节点大于父节点

缺点：当数据出现单边增长时，会退化成链表结构，达不到优化效果

![image-20210702161009634](README.assets/image-20210702161009634.png)

#### 红黑树

平衡二叉树，会随着数据的插入自动做平衡处理，平衡树的左右高度

![image-20210702162700935](README.assets/image-20210702162700935.png)

缺点：数据量大时，树的高度依然不可控

#### Hash（索引方法）

- 对索引的key进行一次hash计算就可以定位出数据存储的位置
- 很多时候Hash索引要比B+Tree索引更高效
- 缺点：仅能满足“=”，“IN”，不支持范围查询；hash冲突问题

![image-20210707213514489](README.assets/image-20210707213514489.png)

#### B-Tree

- 叶子节点具有相同的深度，叶子节点的指针为空
- 所有索引元素不重复
- 节点中的数据索引从左到右递增排列

![image-20210702172350609](README.assets/image-20210702172350609.png)

#### B+Tree（索引方法）

B-Tree变种

- 非叶子节点不存储data，只存储索引（冗余），可以放更多的索引
- 叶子节点包含所有的索引字段
- 叶子节点用指针连接，提高区间访问的性能

![image-20210702172715980](README.assets/image-20210702172715980.png)

tips:

​	mysql默认页大小16kb，假如索引字段使用bigint类型(8byte)，下一个子节点的地址(6byte)，一个非叶子节点约可以存储1170个索引*16384/(8+6)=1170*

可以修改默认页大小，但是不建议。

![image-20210702173900809](README.assets/image-20210702173900809.png)



### 存储引擎

![image-20210707194401860](README.assets/image-20210707194401860.png)

#### MyISAM

- 非聚集索引-叶子节点存放索引和完整数据行的磁盘地址

- MyISAM索引文件和数据文件是分离的

![image-20210707195247159](README.assets/image-20210707195247159.png)

![image-20210707200212975](README.assets/image-20210707200212975.png)

#### InnoDB

- 聚集索引-叶子节点包含了完整的数据行记录
  - 聚集索引的查询速度略优于非聚集索引
- 表数据文件本身就是按照B+Tree组织的一个索引结构文件
- 建议InnoDB表必须建立主键，并且推荐使用整形的自增主键
  - 主键唯一，为了组织B+Tree，必须要有数据唯一列。如果没有主键列，mysql会从表中找一个数据唯一列来组织B+Tree，如果没找到，mysql会建立一个隐藏的数据唯一列（rowid）
  - 整形占用空间小，且利于比较大小
  - B+Tree元素本身是从左到右顺序排列，自增主键可以避免B+Tree重新排列，分裂
- 非主键索引（二级索引，非聚集索引）结构的叶子节点存储的是主键值
  - 节约空间，数据一致性
  - 查询时先定位到主键，再通过主键索引去拿到整行数据（回表）

![image-20210707200625588](README.assets/image-20210707200625588.png)

![image-20210707203955777](README.assets/image-20210707203955777.png)tips:一张表只有一个聚集索引，就是用来组织这棵B+树的索引，通常就是主键

### 联合索引

![image-20210707220555215](README.assets/image-20210707220555215.png)

#### 索引最左前缀原理

查询条件必须符合索引字段从左到右的顺序，不能跳过前面的字段

tips:mysql查询器会优化sql语句的查询字段顺序，即使字段顺序不对也会走索引，前提是不能跳过

![image-20210707220823201](README.assets/image-20210707220823201.png)

为什么？

跳过前面字段的话，无法确定元素是顺序排列的，违背了索引基本要求

![image-20210707221722947](README.assets/image-20210707221722947.png)









